# Telegram Gallery

Онлайн галерея для Telegram канала [@PostSovietPhotography](https://t.me/PostSovietPhotography) с автоматическим обновлением и endless scroll.

## Технологии

- **Astro.js** - основной фреймворк (SSR)
- **React** - компоненты для интерактивной галереи
- **@masonry-grid/react** - адаптивная masonry-сетка для изображений
- **cheerio** - парсинг HTML для получения данных из публичного канала
- **puppeteer** - автоматизация браузера для парсинга
- **TypeScript** - типизация
- **Vercel** - хостинг и Cron Jobs

## Установка

1. Установите зависимости:
```bash
npm install
```

2. Создайте файл `.env` в корне проекта (опционально):
```env
CRON_SECRET=your_secret_for_cron_endpoint
```
`CRON_SECRET` используется для защиты API endpoint синхронизации при деплое на Vercel.

## Разработка

Запуск dev сервера:
```bash
npm run dev
```

## Синхронизация данных

Проект использует веб-парсинг для синхронизации данных из публичных Telegram каналов.

### Инкрементальная синхронизация (рекомендуется)

Для регулярного обновления данных используйте инкрементальную синхронизацию:

```bash
npm run sync-incremental
```

Этот скрипт:
- ✅ Загружает только новые изображения с последней синхронизации
- ✅ Не требует авторизации в Telegram
- ✅ Работает для любых публичных каналов
- ✅ Оптимизирован для больших каналов

### Другие утилиты

**Очистка изображений:**
```bash
npm run cleanup
```
Удаляет логотипы, иконки и другие некорректные изображения из базы данных.

**Проверка битых ссылок:**
```bash
npm run check-broken
```
Проверяет доступность изображений и удаляет битые ссылки.

## Деплой

Подробные инструкции по деплою на Vercel см. в [DEPLOY.md](./DEPLOY.md).

## Структура проекта

```
/
├── src/
│   ├── pages/
│   │   ├── index.astro          # Главная страница
│   │   └── api/
│   │       ├── images.json.ts   # API для получения изображений
│   │       └── sync.ts          # Endpoint для Cron Job
│   ├── components/
│   │   ├── ImageGrid.tsx        # React компонент галереи с endless scroll
│   │   └── ImageGrid.css        # Стили галереи
│   ├── lib/
│   │   ├── telegram-mobile.ts   # Парсинг через мобильную версию Telegram
│   │   └── images.ts            # Утилиты для работы с изображениями
│   └── types/
│       └── image.ts             # TypeScript типы
├── scripts/
│   ├── sync-incremental.ts     # Инкрементальная синхронизация
│   ├── cleanup-images.ts        # Очистка некорректных изображений
│   └── check-broken-images.ts   # Проверка битых ссылок
├── data/
│   └── images.json              # Кэш метаданных изображений
└── vercel.json                  # Конфигурация Vercel
```

## Особенности

- **Endless scroll** - автоматическая загрузка изображений при прокрутке
- **Lazy loading** - оптимизация загрузки изображений
- **Автоматическое обновление** - синхронизация раз в день через GitHub Actions (бесплатно)
- **Адаптивный дизайн** - работает на всех устройствах

## Примечания

- Изображения сохраняются с прямыми URL из Telegram CDN.
- Для больших каналов рекомендуется использовать внешнее хранилище (S3, Cloudinary) или базу данных вместо JSON файла.
- Первая синхронизация может занять время в зависимости от количества сообщений в канале.
- Для автоматического обновления используется GitHub Actions, который запускает синхронизацию раз в день (в 2:00 UTC).
- После синхронизации изменения автоматически коммитятся в репозиторий, и Vercel автоматически пересобирает и деплоит сайт.
- Скрипт `sync-incremental` выполняет инкрементальную синхронизацию, загружая только новые изображения с момента последней синхронизации.

